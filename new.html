<!doctype html>
<html>
    <head>

        <title>jsPlumb - flowchart demonstration</title>
        <meta http-equiv="content-type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" />

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <style>

            .canvas {
                resize: both;
                overflow: scroll !important;
                background-color: #3b3b3b;
                height: 600px;
                display: flex;
                position:relative;
            }

            .canvas ul{
                display: flex;
                position: absolute;
                min-width: 300px;
                z-index: 2;
            }

            .canvas svg{
                stroke: #000;
                z-index: 1;
            }

            .canvas svg path:hover{
                stroke: red !important;
            }

            .canvas svg circle:not(.origin){
                cursor: pointer;
                stroke: yellow;
                fill:   yellow;
                z-index: 5;
            }

            .db-table .datatype{
                float: right;
            }

        </style>

    </head>

    <body>

        <div>
            <div class="canvas" id="canvas" > </div>
            <div class="canvas2" id="canvas" > </div>
        </div>

        <input id='connect' type='checkbox' />
        <button id='save'> Save </button>

        <script src='data.js'></script>
        <script src='src/databaseJs.js'></script>

        <script>
            $('.canvas').databaseJs();
            $('.canvas').databaseJs('buildModel', data);

            //https://www.w3schools.com/graphics/svg_path.asp
            var creatingPath = false;
            var originTable = null;

            $('.canvas').on('click', 'ul', function(e){
                if(creatingPath == false){ return; }
                if(originTable == null){
                    originTable = e.currentTarget;
                }else if( $(e.currentTarget).parent() ){
                    var fieldName = prompt('Table name', $(originTable).attr('id') + "id"); 
                    if(fieldName == null || fieldName == ''){ return; }
                    $('.canvas').databaseJs('createConnection', originTable, e.currentTarget, fieldName); 
                    originTable = null;
                    creatingPath = false;
                    $('#connect').prop('checked', false);
                }
            });

            //#####################################################
            $('#connect').on('change', function(){
                if (creatingPath){
                    creatingPath = false;
                }else{
                    creatingPath = true;
                }
            });

            //####################################################
            $('#save').on('click', function(){ console.log( $('.canvas').databaseJs('export') ); });

        </script>

    </body>
</html>
